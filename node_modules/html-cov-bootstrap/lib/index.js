var fs = require('fs')
  , path = require('path')
  , mocha = require('mocha')
  , JSONCov = mocha.reporters.JSONCov

exports = module.exports = HTMLCovBootstrap

function HTMLCovBootstrap(runner) {
  var jade = require('jade')
    , file = path.join(__dirname, 'templates', 'coverage.jade')
    , str = fs.readFileSync(file, 'utf8')
    , fn = jade.compile(str, { filename: file })
    , self = this

  JSONCov.call(this, runner, false)

  runner.on('end', function() {
    process.stdout.write(fn({
        cov: self.cov
      , coverageClass: coverageClass
    }))
  })
}

function coverageClass(n) {
  if (n >= 75) return 'high'
  if (n >= 50) return 'medium'
  if (n >= 25) return 'low'
  return 'terrible'
}
